---
title: "Assignment 1"
author: "Junbin Wu"
date: "2024-03-10"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Content

1. Model functions (in chronological order)
  - 1.1 Simple Linear Model
  - 1.2 All zeros
  - 1.3 Decision Tree
  
2. Model Evaluation functions
  - 2.1 MSE calculation

3. Main functions
  - 3.1 Library loading
  - 3.2 Data loading
  - 3.3 Models Running
  - 3.4 Model evaluation
  - 3.5 Output as a CSV

# 1. Model functions (in chronological order)

## 1.1 Simple Linear Model
```{r}

model1 <- lm(`281` ~ `7`+`52`+`61`+`62`, data = blogData_train)
# use `52` as the independent varaible, and `281` as the dependent variable.
model1
```

## 1.2 All zeros
By predicting all outcomes as zeros, the MSE is even better than 2.1 Linear Model, which indicate that a simple linear regression would not work.

## 1.3 Decision tree
```{r}
# Build the decision tree model

train.nonzero <- blogData_train[which(blogData_train$`281`>1),]
test.nonzero <- blogData_test_2012_02_01_00_00[which(blogData_test_2012_02_01_00_00$`281`>10),]

second_tree <- rpart(`281` ~ ., data = train.nonzero, method = "anova")




predictions <- predict(second_tree, test.nonzero, type = "matrix")

mse <- mean((predictions - test.nonzero$`281`)^2)
mse

blogData_train<- blogData_train[which(blogData_train$`281`>10),]

#blogData_train$`281` <- ifelse(blogData_train$`281` == 0,0,1)
first_tree <- rpart(`281` ~ ., data = blogData_train, method = "anova")

#blogData_test_2012_02_01_00_00$`281`<- ifelse(blogData_test_2012_02_01_00_00$`281` == 0,0,1)
predictions <- predict(first_tree, test.nonzero, type = "matrix")
summary(predictions)

mse <- mean((predictions - blogData_test$`281`)^2)
mse

outputcsv <- data.frame(ID = c(0:213))
outputcsv$num_comments <- as.vector(predictions)

write.csv(outputcsv, "csv_for_submission/031204.csv", row.names = FALSE)


```

# 2. Model Evaluation functions

## 2.1 MSE calculation
```{r}
predicted <- predict(model1, newdata=blogData_test_2012_02_01_00_00)
mse <- mean((predicted - blogData_test_2012_02_01_00_00$`281`)^2)
mse
```



# 3. Main functions

The Main function calls all other functions above intermittently for the purpose of high efficiency and maintenance, due to high cohesion and low coupling.

## 3.1 Library loading

```{r}
library(readr)
library(glmnet)
library(rpart)
library(rpart.plot)
```

## 3.2 Data loading

The data used here have been pre-processed. I added headers 1-281 for every data set. For the training set, I removed all duplicates, so the total observations come down from 52,397 to 49,203.
```{r}
train_set <- read_csv("data/Processed Data Set/blogData_train duplicate removed.csv")

final_test_set <- read_csv("data/Processed Data Set/blogData_test.csv")

test_set_201 <- read_csv("data/Processed Data Set/blogData_test-2012.02.01.00_00.csv")
```
## 3.3 Models running

## 3.4 Model evaluation

## 3.5 Output-as-a-CSV
```{r}

outputcsv <- data.frame(ID = c(0:213))
outputcsv$num_comments <- as.vector(predicted)

write.csv(outputcsv, "csv_for_submission/031201.csv", row.names = FALSE)

```








